# -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# Fabian Kastner
# 2020.12.05
# -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------

import http.client
import configparser

import pandas as pd
from alpha_vantage.timeseries import TimeSeries

# -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------


def get_df_from_symbol(symbol):
    config = configparser.ConfigParser()
    config.read(".config.ini")
    key = config["default"]["alpha_vantage_api_key"]

    ts = TimeSeries(key)
    data_, meta = ts.get_daily(symbol=symbol)

    data = pd.DataFrame(data_)
    data = data.transpose()
    data.sort_index(ascending=True, inplace=True)
    data.reset_index(inplace=True)

    colnames = ["date", "open", "high", "low", "close", "volume"]
    data.columns = colnames
    data["date"] = pd.to_datetime(data["date"], format="%Y-%m-%d")
    
    for colname in colnames[1:]:
        data[colname] = pd.to_numeric(data[colname])

    return data

# -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
